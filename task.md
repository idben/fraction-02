# 分數學習教材 - 實作任務清單

## 製作步驟

### 1. 基礎 HTML 結構 ✅
- [x] 建立 index.html
- [x] 建立基本 HTML5 架構
- [x] 加入 SVG 畫布用於繪製矩形和分割線
- [x] 建立控制按鈕區域
- [x] 建立 dialog 元素用於顯示結果

### 2. CSS 樣式設計 ✅
- [x] 建立 styles.css
- [x] 實作 Bootstrap 風格的按鈕樣式（btn-primary、btn-danger、btn-warning）
- [x] 設計半圓形點的樣式，與矩形邊融合
- [x] 設定白色背景
- [x] 設計矩形和分割線的樣式
- [x] 設計填色區域的樣式和 hover 效果

### 3. JavaScript 核心功能 ✅
- [x] 建立 app.js
- [x] 使用狀態管理系統（使用 Set 和物件，Proxy 選用）
  - 追蹤水平分割線狀態
  - 追蹤垂直分割線狀態
  - 追蹤填色區域狀態
- [x] 實作矩形繪製功能（含邊上的點）
- [x] 實作點擊點位連線功能
  - 水平線連接（上邊點 → 下邊點）
  - 垂直線連接（左邊點 → 右邊點）
- [x] 實作分割區域計算演算法
- [x] 實作點擊填色/取消填色功能
- [x] 實作分數計算功能
- [x] 使用 dialog 顯示結果

### 4. 互動邏輯 ✅
- [x] 使用 querySelector 選擇單一元素
- [x] 使用 querySelectorAll 選擇多個元素
- [x] 綁定點擊事件監聽器
- [x] 實作點位連線的視覺回饋
- [x] 實作填色區域的視覺回饋

### 5. 測試與優化 ✅
- [x] 修復點位顯示問題（改用圓形並調整 viewBox）
- [x] 優化點位 hover 效果（從中心放大）
- [x] 優化填色區域視覺回饋（加入淡藍色邊框，讓區域可見）
- [x] 修復水平/垂直線方向混淆問題（上下連接→垂直線，左右連接→水平線）
- [x] 修正分數計算方式（改為按實際面積計算，而非區域數量）
- [x] 優化 Dialog 顯示效果（置中顯示、半透明黑色背景遮罩、模糊效果）
- [x] 優化圓點樣式（移除外框，只保留填色）
- [x] 矩形外框改為綠色（與圓點同色）
- [x] 手機版面優化（內容齊上不置中）
- [x] 移除 SVG 外框和背景（與頁面融為一體）
- [x] 調整 SVG 元素順序（矩形蓋在圓點上，形成半圓效果）
- [x] 修復半圓形路徑問題（改回使用完整圓形，由矩形自然遮蔽形成半圓）

### 6. 答題機制 ⏳
- [ ] 新增題庫系統（根據 plan.md 的分母2~10切分方式）
- [ ] 新增題目生成函式（隨機選擇分母和切分方式，動態調整矩形高度）
- [ ] 開始時用 dialog 顯示題目（小朋友語氣：「請把 1/3 塗上顏色喔！」）
- [ ] 矩形中央顯示大字分數（如 1/3）
- [ ] 小朋友需要自己畫線切分 + 填色
- [ ] 新增計分系統（右上角只顯示「10 分」，不顯示題數和總分）
- [ ] 新增「確認答案」按鈕
- [ ] 新增答案驗證邏輯

### 7. 回饋機制 ⏳
- [ ] 新增音效播放功能（correct.mp3、wrong.mp3、victory.mp3）
- [ ] 答對：播放音效 + 立繪瞬間出現（happy.png）+ dialog 顯示鼓勵話
- [ ] 答錯：播放音效 + 立繪瞬間出現（sad.png）+ dialog 顯示正確示範
- [ ] 答錯示範：系統自動展示正確的切割與填色方式
- [ ] 答錯後顯示「我知道了」按鈕，讓小朋友重試
- [ ] 重試答對不給分
- [ ] 全部答對：播放 victory 音效 + pass.png 立繪

### 8. 視覺優化 ⏳
- [ ] 矩形寬度 800，高度根據分母動態調整（奇數分母時使用可整除的數字）
- [ ] 手機上剛好一個螢幕，不出現捲軸
- [ ] 立繪圖片在 backdrop 左下角（RPG 風格），只在答對/答錯瞬間出現

### 9. 最終測試 ⏳
- [ ] 測試所有分母 2~10 的題目
- [ ] 測試答對/答錯的回饋與重試機制
- [ ] 測試勝利畫面
- [ ] 手機版面測試

## 已確認的規格細節

### 1. 視覺設計規格 ✓
- **矩形尺寸**：預設 800x400 px（需支援 RWD，手機可正常顯示）
- **點的大小**：直徑 30px（方便手指點擊，使用變數可調整）
- **線條粗細**：3px（使用變數可調整）
- **填色顏色**：藍色調半透明（淺藍色）
- **按鈕文字**：
  - 計算分數按鈕：「顯示結果」
  - 需要「重置」按鈕

### 2. 互動規格 ✓
- **連線模式**：
  - 點擊第一個點後，高亮顯示對應邊的可連接點
  - 可以取消已繪製的線
  - 不可重複點擊同樣的點位組合
- **填色邏輯**：
  - 不需要動畫效果
  - 不限制填色區域數量
- **結果顯示**：
  - Dialog 可動態塞入資訊
  - 需要化簡分數，兩種都顯示（如：8/32 = 1/4）
  - Dialog 目前只需「關閉」按鈕（未來可能按需求增加「確定」，支援 1-2 個按鈕）

### 3. 技術規格 ✓
- **Proxy 使用**：
  - 目前無強制需求
  - 有需要動態顯示時再使用此技術
- **分割區域演算法**：
  - 按實際結果計算（不使用格點計算法）
  - 需處理複雜交叉區域的正確計算

### 4. 邊界情況處理 ✓
- 沒有繪製任何分割線就填色：填滿整個矩形
- 沒有填色就按計算按鈕：跳出警告（使用 dialog）
- 複雜交叉區域：按實際結果計算

---

## 技術實作重點

### CSS 變數設計
```css
:root {
  --rect-width: 800px;
  --rect-height: 400px;
  --point-diameter: 30px;
  --line-width: 3px;
  --fill-color: rgba(100, 149, 237, 0.3); /* 淺藍色半透明 */
}
```

### RWD 斷點
- 桌面：800x400 (預設)
- 平板：適當縮放
- 手機：自適應寬度，保持比例

### 核心功能優先順序
1. ✅ 基本繪圖與分割線
2. ✅ 填色功能
3. ✅ 分數計算（含化簡）
4. ✅ 線條刪除功能
5. ✅ 重置功能
6. ✅ RWD 響應式設計

---

## 已完成功能列表

### 基本功能
- ✅ SVG 矩形繪製（800x400px）
- ✅ 邊緣半圓形點位（上下各7個，左右各3個）與矩形邊緣融合
- ✅ 點擊點位連線（水平線、垂直線）
- ✅ 點位高亮提示（選中點時顯示可連接的對應點，帶脈動動畫）
- ✅ 防止重複連線
- ✅ 點擊線條可刪除

### 視覺優化
- ✅ 點位從中心放大的 hover 效果（使用 transform-origin: center）
- ✅ 調整 SVG viewBox 以容納邊緣點位
- ✅ 綠色半圓點配色（#4CAF50）便於識別，無外框只填色
- ✅ 矩形外框使用綠色（與半圓點同色）
- ✅ 矩形蓋在半圓上，形成半圓與邊緣融合效果
- ✅ SVG 畫布無邊框、透明背景（與頁面融為一體）
- ✅ 填色區域加入淡藍色邊框（stroke），未填色區域也清晰可見
- ✅ Hover 區域時顯示淡藍色背景提示
- ✅ 已填色區域有更深的邊框和背景色
- ✅ 手機版面內容齊上顯示（align-items: flex-start）

### 填色功能
- ✅ 自動計算分割區域
- ✅ 點擊區域填色/取消填色
- ✅ 填色狀態追蹤

### 計算功能
- ✅ 分數計算（按實際填色面積計算，非區域數量）
- ✅ 分數化簡（使用最大公約數）
- ✅ Dialog 動態顯示結果（區域數、面積、百分比、原分數、化簡分數）
- ✅ 未填色時顯示警告

### UI/UX
- ✅ Bootstrap 風格按鈕（btn-primary、btn-danger、btn-warning）
- ✅ 重置按鈕（清除所有線條和填色）
- ✅ Hover 效果（點位、線條、填色區域）
- ✅ RWD 響應式設計（桌面、平板、手機）
- ✅ Dialog 完美置中顯示（使用 fixed + transform）
- ✅ 半透明黑色背景遮罩（opacity: 0.6）
- ✅ 背景模糊效果（backdrop-filter: blur）

### 技術要求
- ✅ 純 HTML/CSS/JS
- ✅ 未使用 JS 框架
- ✅ 未使用 CSS 框架
- ✅ 使用 querySelector 與 querySelectorAll
- ✅ 使用 dialog 代替 alert
- ✅ CSS 變數設計（可調整尺寸、顏色）
